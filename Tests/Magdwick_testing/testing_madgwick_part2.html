<!DOCTYPE html> <html> <head> <title>testing_madgwick_part2</title> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">  <style> .markdown-preview-enhanced { font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif; font-size: 16px; line-height: 1.6; color: rgb(171, 178, 191); overflow: initial; margin: 10px 13px; padding: 2em; box-sizing: border-box; word-wrap: break-word; background-color: rgb(40, 44, 52); }
.markdown-preview-enhanced[data-use-github-style] { color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); }
.markdown-preview-enhanced > :first-child { margin-top: 0px; }
.markdown-preview-enhanced[is="space-pen-div"] { width: 100%; margin: 0px; z-index: 999; overflow: scroll; font-size: 16px; display: block; position: absolute; }
.markdown-preview-enhanced[is="space-pen-div"][data-use-github-style] { }
.markdown-preview-enhanced[is="space-pen-div"][data-use-github-style] ::-webkit-scrollbar-track { box-shadow: rgba(218, 218, 218, 0.6) 0px 0px 3px inset; background-color: rgb(244, 244, 244); }
.markdown-preview-enhanced[is="space-pen-div"][data-use-github-style] ::-webkit-scrollbar-thumb { border-radius: 10px; border-color: transparent; background-color: rgb(204, 204, 204); }
.markdown-preview-enhanced h1, .markdown-preview-enhanced h2, .markdown-preview-enhanced h3, .markdown-preview-enhanced h4, .markdown-preview-enhanced h5, .markdown-preview-enhanced h6 { line-height: 1.2; margin-top: 1em; margin-bottom: 16px; color: rgb(255, 255, 255); }
.markdown-preview-enhanced[data-use-github-style] h1, .markdown-preview-enhanced[data-use-github-style] h2, .markdown-preview-enhanced[data-use-github-style] h3, .markdown-preview-enhanced[data-use-github-style] h4, .markdown-preview-enhanced[data-use-github-style] h5 { color: rgb(51, 51, 51); font-weight: 600; }
.markdown-preview-enhanced[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview-enhanced[data-use-github-style] h6 { color: rgb(119, 119, 119); }
.markdown-preview-enhanced h1 { font-size: 2.25em; font-weight: 300; padding-bottom: 0.3em; border-bottom: 1px solid rgb(75, 83, 98); }
.markdown-preview-enhanced h2 { font-size: 1.75em; font-weight: 400; padding-bottom: 0.3em; border-bottom: 1px solid rgb(75, 83, 98); }
.markdown-preview-enhanced h3 { font-size: 1.5em; font-weight: 500; }
.markdown-preview-enhanced h4 { font-size: 1.25em; font-weight: 600; }
.markdown-preview-enhanced h5 { font-size: 1.1em; font-weight: 600; }
.markdown-preview-enhanced h6 { font-size: 1em; font-weight: 600; }
.markdown-preview-enhanced[data-use-github-style] h1, .markdown-preview-enhanced[data-use-github-style] h2 { border-bottom: 1px solid rgb(231, 231, 231); }
.markdown-preview-enhanced strong { color: rgb(255, 255, 255); }
.markdown-preview-enhanced[data-use-github-style] strong { color: rgb(51, 51, 51); }
.markdown-preview-enhanced del { color: rgb(124, 135, 156); }
.markdown-preview-enhanced a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview-enhanced a { color: rgb(0, 136, 204); text-decoration: none; }
.markdown-preview-enhanced a:hover { color: rgb(0, 80, 163); text-decoration: none; }
.markdown-preview-enhanced img, .markdown-preview-enhanced svg { max-width: 100%; }
.markdown-preview-enhanced > p { margin-top: 0px; margin-bottom: 16px; word-wrap: break-word; }
.markdown-preview-enhanced > ul, .markdown-preview-enhanced > ol { margin-bottom: 16px; }
.markdown-preview-enhanced ul, .markdown-preview-enhanced ol { padding-left: 2em; }
.markdown-preview-enhanced ul.no-list, .markdown-preview-enhanced ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview-enhanced ul ul, .markdown-preview-enhanced ul ol, .markdown-preview-enhanced ol ol, .markdown-preview-enhanced ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview-enhanced li { margin-bottom: 0px; }
.markdown-preview-enhanced li.task-list-item { list-style: none; }
.markdown-preview-enhanced li > p { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview-enhanced .task-list-item-checkbox { margin: 0px 0.2em 0.25em -1.6em; vertical-align: middle; }
.markdown-preview-enhanced .task-list-item-checkbox:hover { cursor: pointer; }
.markdown-preview-enhanced blockquote { margin: 16px 0px; font-size: inherit; padding: 0px 15px; color: rgb(124, 135, 156); border-left: 4px solid rgb(75, 83, 98); }
.markdown-preview-enhanced blockquote > :first-child { margin-top: 0px; }
.markdown-preview-enhanced blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview-enhanced[data-use-github-style] blockquote { color: rgb(119, 119, 119); border-left: 4px solid rgb(221, 221, 221); }
.markdown-preview-enhanced hr { height: 4px; margin: 32px 0px; border: 0px none; background-color: rgb(75, 83, 98); }
.markdown-preview-enhanced[data-use-github-style] hr { background-color: rgb(231, 231, 231); }
.markdown-preview-enhanced table { margin: 10px 0px 15px; border-collapse: collapse; border-spacing: 0px; display: block; width: 100%; overflow: auto; word-break: keep-all; }
.markdown-preview-enhanced table th { font-weight: bold; color: rgb(255, 255, 255); }
.markdown-preview-enhanced table td, .markdown-preview-enhanced table th { border: 1px solid rgb(75, 83, 98); padding: 6px 13px; }
.markdown-preview-enhanced[data-use-github-style] th { color: rgb(51, 51, 51); }
.markdown-preview-enhanced[data-use-github-style] td, .markdown-preview-enhanced[data-use-github-style] th { border: 1px solid rgb(221, 221, 221); }
.markdown-preview-enhanced dl { padding: 0px; }
.markdown-preview-enhanced dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview-enhanced dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview-enhanced code { font-family: Menlo, Monaco, Consolas, "Courier New", monospace; color: rgb(255, 255, 255); border-radius: 3px; padding: 0.2em 0px; font-size: 0.85em !important; background-color: rgb(58, 63, 75); }
.markdown-preview-enhanced code::before, .markdown-preview-enhanced code::after { letter-spacing: -0.2em; content: " "; }
.markdown-preview-enhanced[data-use-github-style] code { color: inherit; background-color: rgba(0, 0, 0, 0.0392157) !important; }
.markdown-preview-enhanced pre > code { padding: 0px; margin: 0px; word-break: normal; white-space: pre; border: 0px; font-size: 0.85em !important; background: transparent; }
.markdown-preview-enhanced .highlight { margin-bottom: 16px; }
.markdown-preview-enhanced .highlight pre, .markdown-preview-enhanced pre { font-family: Menlo, Monaco, Consolas, "Courier New", monospace; padding: 16px; overflow: auto; line-height: 1.45; color: rgb(171, 178, 191); border: rgb(75, 83, 98); border-radius: 3px; font-size: 0.85em !important; background-color: rgb(49, 54, 63); }
.markdown-preview-enhanced .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview-enhanced pre { word-wrap: break-word; white-space: normal; word-break: break-all; }
.markdown-preview-enhanced pre .section { opacity: 1; }
.markdown-preview-enhanced pre code, .markdown-preview-enhanced pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview-enhanced pre code::before, .markdown-preview-enhanced pre tt::before, .markdown-preview-enhanced pre code::after, .markdown-preview-enhanced pre tt::after { content: normal; }
.markdown-preview-enhanced p, .markdown-preview-enhanced blockquote, .markdown-preview-enhanced ul, .markdown-preview-enhanced ol, .markdown-preview-enhanced dl, .markdown-preview-enhanced pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview-enhanced pre.editor-colors { margin: 16px 0px; padding: 1em; font-size: 0.92em; border-radius: 3px; background-color: rgb(49, 54, 63); }
.markdown-preview-enhanced kbd { color: rgb(255, 255, 255); border-width: 1px 1px 2px; border-style: solid; border-color: rgb(75, 83, 98) rgb(75, 83, 98) rgb(62, 68, 81); padding: 2px 4px; background-color: rgb(58, 63, 75); }
.markdown-preview-enhanced[data-use-github-style] kbd { color: rgb(51, 51, 51); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview-enhanced .pagebreak, .markdown-preview-enhanced .newpage { break-before: page; }
@media screen and (min-width: 914px) { 
  .markdown-preview-enhanced { width: 980px; margin: 10px auto; background: rgb(40, 44, 52); }
}
@media screen and (max-width: 400px) { 
  .markdown-preview-enhanced { font-size: 14px; margin: 0px auto; padding: 15px; }
}
@media screen and (min-width: 914px) { 
  .markdown-preview-enhanced[data-use-github-style] { background: rgb(255, 255, 255); }
}
@media print { 
  .markdown-preview-enhanced { background-color: rgb(40, 44, 52); }
  .markdown-preview-enhanced h1, .markdown-preview-enhanced h2, .markdown-preview-enhanced h3, .markdown-preview-enhanced h4, .markdown-preview-enhanced h5, .markdown-preview-enhanced h6 { color: rgb(255, 255, 255); break-after: avoid; }
  .markdown-preview-enhanced blockquote { color: rgb(124, 135, 156); }
  .markdown-preview-enhanced table, .markdown-preview-enhanced pre { break-inside: avoid; }
  .markdown-preview-enhanced table { display: table; }
  .markdown-preview-enhanced img { display: block; max-width: 100%; max-height: 100%; }
  .markdown-preview-enhanced pre, .markdown-preview-enhanced code { word-wrap: break-word; white-space: normal; }
}
@media print { 
  .markdown-preview-enhanced[data-use-github-style] { background-color: rgb(255, 255, 255); }
  .markdown-preview-enhanced[data-use-github-style] h1, .markdown-preview-enhanced[data-use-github-style] h2, .markdown-preview-enhanced[data-use-github-style] h3, .markdown-preview-enhanced[data-use-github-style] h4, .markdown-preview-enhanced[data-use-github-style] h5, .markdown-preview-enhanced[data-use-github-style] h6 { color: rgb(34, 34, 34); }
  .markdown-preview-enhanced[data-use-github-style] blockquote { color: rgb(119, 119, 119); }
  .markdown-preview-enhanced[data-use-github-style] pre { border: 2px solid rgb(246, 246, 246); }
}
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk { position: relative; }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk .output-div { overflow-x: auto; }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk .output-div svg { display: block; }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk pre { cursor: text; }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk .btn-group { position: absolute; right: 0px; top: 0px; display: none; }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk .btn-group .run-btn, .markdown-preview-enhanced[is="space-pen-div"] .code-chunk .btn-group .run-all-btn { float: right; margin-left: 4px; border-radius: 3px; font-size: 0.8em; color: rgb(238, 238, 238); border: none; background-image: none; background-color: rgb(82, 139, 255); }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk .btn-group .run-btn:hover, .markdown-preview-enhanced[is="space-pen-div"] .code-chunk .btn-group .run-all-btn:hover { cursor: pointer; background-color: rgb(75, 127, 232); }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk:hover .btn-group { display: block; }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk .status { position: absolute; right: 0px; top: 0px; font-size: 0.85em; color: inherit; padding: 2px 6px; display: none; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk.running .btn-group { display: none; }
.markdown-preview-enhanced[is="space-pen-div"] .code-chunk.running .status { display: block; }
.markdown-preview-enhanced[is="space-pen-div"] .back-to-top-btn, .markdown-preview-enhanced[is="space-pen-div"] .refresh-btn { position: fixed; display: none; right: 24px; top: 54px; }
.markdown-preview-enhanced[is="space-pen-div"] .back-to-top-btn { right: 72px; }
.markdown-preview-enhanced[is="space-pen-div"]:hover .back-to-top-btn, .markdown-preview-enhanced[is="space-pen-div"]:hover .refresh-btn { display: block; opacity: 0.4; }
.markdown-preview-enhanced[is="space-pen-div"]:hover .back-to-top-btn:hover, .markdown-preview-enhanced[is="space-pen-div"]:hover .refresh-btn:hover { opacity: 1; }
.markdown-preview-enhanced:not([is="space-pen-div"]) .code-chunk .btn-group { display: none; }
.markdown-preview-enhanced:not([is="space-pen-div"]) .code-chunk .status { display: none; }
.markdown-preview-enhanced:not([is="space-pen-div"]) .back-to-top-btn { display: none; }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors { color: rgb(51, 51, 51); background-color: rgb(247, 247, 247); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .line.cursor-line { background-color: rgb(245, 245, 245); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .invisible { color: rgb(192, 192, 192); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .cursor { border-left: 2px solid rgb(0, 0, 0); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .selection .region { background-color: rgb(200, 200, 250); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .bracket-matcher .region { border-bottom: 1px solid rgb(0, 0, 0); box-sizing: border-box; }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .invisible-character { color: rgb(192, 192, 192); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .indent-guide { color: rgb(192, 192, 192); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .wrap-guide { background-color: rgb(192, 192, 192); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .gutter { color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .gutter .line-number { color: rgb(51, 51, 51); -webkit-font-smoothing: antialiased; }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .gutter .line-number.cursor-line { color: rgb(51, 51, 51); background-color: rgb(245, 245, 245); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .gutter .line-number.cursor-line-no-selection { background-color: transparent; }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .gutter .line-number .icon-right { color: rgb(51, 51, 51); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .gutter:not(.git-diff-icon) .line-number.git-line-removed.git-line-removed::before { bottom: -3px; }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .gutter:not(.git-diff-icon) .line-number.git-line-removed::after { content: ""; position: absolute; left: 0px; bottom: 0px; width: 25px; border-bottom: 1px dotted rgba(255, 236, 236, 0.498039); pointer-events: none; }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .gutter .line-number.folded, .markdown-preview-enhanced .github-syntax-theme pre.editor-colors .gutter .line-number::after, .markdown-preview-enhanced .github-syntax-theme pre.editor-colors .fold-marker::after { color: rgb(51, 51, 51); }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .search-results .mpe-syntax--marker .region { border: 1px solid rgb(237, 106, 67); background-color: transparent; }
.markdown-preview-enhanced .github-syntax-theme pre.editor-colors .search-results .mpe-syntax--marker.current-result .region { border: 1px solid rgb(255, 255, 255); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--comment, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--comment, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string.mpe-syntax--comment { color: rgb(150, 152, 150); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--constant, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--entity.mpe-syntax--name.mpe-syntax--constant, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--variable.mpe-syntax--other.mpe-syntax--constant, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--variable.mpe-syntax--language { color: rgb(0, 134, 179); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--entity, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--entity.mpe-syntax--name { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(121, 93, 163); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--variable.mpe-syntax--parameter.mpe-syntax--function { color: rgb(51, 51, 51); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--entity.mpe-syntax--name.mpe-syntax--tag { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(99, 163, 92); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--keyword { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(167, 29, 93); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--storage, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--storage.mpe-syntax--type { color: rgb(167, 29, 93); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--storage.mpe-syntax--modifier.mpe-syntax--package, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--storage.mpe-syntax--modifier.mpe-syntax--import, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--storage.mpe-syntax--type.mpe-syntax--java { color: rgb(51, 51, 51); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--string, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string .mpe-syntax--punctuation.mpe-syntax--section.mpe-syntax--embedded .mpe-syntax--source { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(24, 54, 145); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--support { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(0, 134, 179); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--meta.mpe-syntax--property-name { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(0, 134, 179); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--variable { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(237, 106, 67); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--variable.mpe-syntax--other { color: rgb(51, 51, 51); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--invalid.mpe-syntax--broken { font-weight: bold; font-style: italic; text-decoration: underline; color: rgb(181, 42, 29); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--invalid.mpe-syntax--deprecated { font-weight: bold; font-style: italic; text-decoration: underline; color: rgb(181, 42, 29); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--invalid.mpe-syntax--illegal { font-style: italic; text-decoration: underline; color: rgb(248, 248, 248); background-color: rgb(181, 42, 29); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--carriage-return { font-style: italic; text-decoration: underline; color: rgb(248, 248, 248); background-color: rgb(181, 42, 29); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--invalid.mpe-syntax--unimplemented { font-weight: bold; font-style: italic; text-decoration: underline; color: rgb(181, 42, 29); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--message.mpe-syntax--error { color: rgb(181, 42, 29); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string .mpe-syntax--source { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(51, 51, 51); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string .mpe-syntax--variable { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(0, 134, 179); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--source.mpe-syntax--regexp, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string.mpe-syntax--regexp { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(24, 54, 145); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string.mpe-syntax--regexp.mpe-syntax--character-class, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string.mpe-syntax--regexp .mpe-syntax--constant.mpe-syntax--character.mpe-syntax--escape, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string.mpe-syntax--regexp .mpe-syntax--source.mpe-syntax--ruby.mpe-syntax--embedded, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string.mpe-syntax--regexp .mpe-syntax--string.mpe-syntax--regexp.mpe-syntax--arbitrary-repitition { color: rgb(24, 54, 145); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string.mpe-syntax--regexp .mpe-syntax--constant.mpe-syntax--character.mpe-syntax--escape { font-weight: bold; color: rgb(99, 163, 92); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--support.mpe-syntax--constant { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(0, 134, 179); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--support.mpe-syntax--variable { color: rgb(0, 134, 179); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--meta.mpe-syntax--module-reference { color: rgb(0, 134, 179); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--list { color: rgb(105, 58, 23); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--heading, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--heading .mpe-syntax--entity.mpe-syntax--name { font-weight: bold; color: rgb(29, 62, 129); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--quote { color: rgb(0, 128, 128); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--italic { font-style: italic; color: rgb(51, 51, 51); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--bold { font-weight: bold; color: rgb(51, 51, 51); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--raw { font-weight: normal; font-style: normal; text-decoration: none; color: rgb(0, 134, 179); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--deleted, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--meta.mpe-syntax--diff.mpe-syntax--header.mpe-syntax--from-file, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--deleted { color: rgb(189, 44, 0); background-color: rgb(255, 236, 236); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--inserted, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--meta.mpe-syntax--diff.mpe-syntax--header.mpe-syntax--to-file, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--inserted { color: rgb(85, 165, 50); background-color: rgb(234, 255, 234); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--changed, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--changed { color: rgb(239, 151, 0); background-color: rgb(255, 227, 180); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--ignored, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--markup.mpe-syntax--untracked { color: rgb(216, 216, 216); background-color: rgb(128, 128, 128); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--meta.mpe-syntax--diff.mpe-syntax--range { color: rgb(121, 93, 163); font-weight: bold; }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--meta.mpe-syntax--diff.mpe-syntax--header { color: rgb(0, 134, 179); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--meta.mpe-syntax--separator { font-weight: bold; color: rgb(29, 62, 129); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--meta.mpe-syntax--output { color: rgb(29, 62, 129); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--brackethighlighter.mpe-syntax--tag, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--brackethighlighter.mpe-syntax--curly, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--brackethighlighter.mpe-syntax--round, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--brackethighlighter.mpe-syntax--square, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--brackethighlighter.mpe-syntax--angle, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--brackethighlighter.mpe-syntax--quote { color: rgb(89, 94, 98); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--brackethighlighter.mpe-syntax--unmatched { color: rgb(181, 42, 29); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--sublimelinter.mpe-syntax--mark.mpe-syntax--error { color: rgb(181, 42, 29); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--sublimelinter.mpe-syntax--mark.mpe-syntax--warning { color: rgb(237, 106, 67); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--sublimelinter.mpe-syntax--gutter-mark { color: rgb(192, 192, 192); }
.markdown-preview-enhanced .github-syntax-theme .mpe-syntax--constant.mpe-syntax--other.mpe-syntax--reference.mpe-syntax--link, .markdown-preview-enhanced .github-syntax-theme .mpe-syntax--string.mpe-syntax--other.mpe-syntax--link { color: rgb(24, 54, 145); text-decoration: underline; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors { color: rgb(51, 51, 51) !important; background-color: rgb(247, 247, 247) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .line.cursor-line { background-color: rgb(245, 245, 245) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .invisible { color: rgb(192, 192, 192) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .cursor { border-left: 2px solid rgb(0, 0, 0) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .selection .region { background-color: rgb(200, 200, 250) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .bracket-matcher .region { border-bottom: 1px solid rgb(0, 0, 0) !important; box-sizing: border-box !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .invisible-character { color: rgb(192, 192, 192) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .indent-guide { color: rgb(192, 192, 192) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .wrap-guide { background-color: rgb(192, 192, 192) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .gutter { color: rgb(51, 51, 51) !important; background-color: rgb(255, 255, 255) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .gutter .line-number { color: rgb(51, 51, 51) !important; -webkit-font-smoothing: antialiased !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .gutter .line-number.cursor-line { color: rgb(51, 51, 51) !important; background-color: rgb(245, 245, 245) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .gutter .line-number.cursor-line-no-selection { background-color: transparent !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .gutter .line-number .icon-right { color: rgb(51, 51, 51) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .gutter:not(.git-diff-icon) .line-number.git-line-removed.git-line-removed::before { bottom: -3px !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .gutter:not(.git-diff-icon) .line-number.git-line-removed::after { content: "" !important; position: absolute !important; left: 0px !important; bottom: 0px !important; width: 25px !important; border-bottom: 1px dotted rgba(255, 236, 236, 0.498039) !important; pointer-events: none !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .gutter .line-number.folded, .markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .gutter .line-number::after, .markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .fold-marker::after { color: rgb(51, 51, 51) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .search-results .mpe-syntax--marker .region { border: 1px solid rgb(237, 106, 67) !important; background-color: transparent !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] pre.editor-colors .search-results .mpe-syntax--marker.current-result .region { border: 1px solid rgb(255, 255, 255) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--comment, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--comment, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string.mpe-syntax--comment { color: rgb(150, 152, 150) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--constant, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--entity.mpe-syntax--name.mpe-syntax--constant, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--variable.mpe-syntax--other.mpe-syntax--constant, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--variable.mpe-syntax--language { color: rgb(0, 134, 179) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--entity, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--entity.mpe-syntax--name { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(121, 93, 163) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--variable.mpe-syntax--parameter.mpe-syntax--function { color: rgb(51, 51, 51) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--entity.mpe-syntax--name.mpe-syntax--tag { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(99, 163, 92) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--keyword { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(167, 29, 93) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--storage, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--storage.mpe-syntax--type { color: rgb(167, 29, 93) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--storage.mpe-syntax--modifier.mpe-syntax--package, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--storage.mpe-syntax--modifier.mpe-syntax--import, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--storage.mpe-syntax--type.mpe-syntax--java { color: rgb(51, 51, 51) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--string, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string .mpe-syntax--punctuation.mpe-syntax--section.mpe-syntax--embedded .mpe-syntax--source { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(24, 54, 145) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--support { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(0, 134, 179) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--meta.mpe-syntax--property-name { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(0, 134, 179) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--variable { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(237, 106, 67) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--variable.mpe-syntax--other { color: rgb(51, 51, 51) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--invalid.mpe-syntax--broken { font-weight: bold !important; font-style: italic !important; text-decoration: underline !important; color: rgb(181, 42, 29) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--invalid.mpe-syntax--deprecated { font-weight: bold !important; font-style: italic !important; text-decoration: underline !important; color: rgb(181, 42, 29) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--invalid.mpe-syntax--illegal { font-style: italic !important; text-decoration: underline !important; color: rgb(248, 248, 248) !important; background-color: rgb(181, 42, 29) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--carriage-return { font-style: italic !important; text-decoration: underline !important; color: rgb(248, 248, 248) !important; background-color: rgb(181, 42, 29) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--invalid.mpe-syntax--unimplemented { font-weight: bold !important; font-style: italic !important; text-decoration: underline !important; color: rgb(181, 42, 29) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--message.mpe-syntax--error { color: rgb(181, 42, 29) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string .mpe-syntax--source { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(51, 51, 51) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string .mpe-syntax--variable { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(0, 134, 179) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--source.mpe-syntax--regexp, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string.mpe-syntax--regexp { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(24, 54, 145) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string.mpe-syntax--regexp.mpe-syntax--character-class, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string.mpe-syntax--regexp .mpe-syntax--constant.mpe-syntax--character.mpe-syntax--escape, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string.mpe-syntax--regexp .mpe-syntax--source.mpe-syntax--ruby.mpe-syntax--embedded, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string.mpe-syntax--regexp .mpe-syntax--string.mpe-syntax--regexp.mpe-syntax--arbitrary-repitition { color: rgb(24, 54, 145) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string.mpe-syntax--regexp .mpe-syntax--constant.mpe-syntax--character.mpe-syntax--escape { font-weight: bold !important; color: rgb(99, 163, 92) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--support.mpe-syntax--constant { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(0, 134, 179) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--support.mpe-syntax--variable { color: rgb(0, 134, 179) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--meta.mpe-syntax--module-reference { color: rgb(0, 134, 179) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--list { color: rgb(105, 58, 23) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--heading, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--heading .mpe-syntax--entity.mpe-syntax--name { font-weight: bold !important; color: rgb(29, 62, 129) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--quote { color: rgb(0, 128, 128) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--italic { font-style: italic !important; color: rgb(51, 51, 51) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--bold { font-weight: bold !important; color: rgb(51, 51, 51) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--raw { font-weight: normal !important; font-style: normal !important; text-decoration: none !important; color: rgb(0, 134, 179) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--deleted, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--meta.mpe-syntax--diff.mpe-syntax--header.mpe-syntax--from-file, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--deleted { color: rgb(189, 44, 0) !important; background-color: rgb(255, 236, 236) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--inserted, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--meta.mpe-syntax--diff.mpe-syntax--header.mpe-syntax--to-file, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--inserted { color: rgb(85, 165, 50) !important; background-color: rgb(234, 255, 234) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--changed, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--punctuation.mpe-syntax--definition.mpe-syntax--changed { color: rgb(239, 151, 0) !important; background-color: rgb(255, 227, 180) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--ignored, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--markup.mpe-syntax--untracked { color: rgb(216, 216, 216) !important; background-color: rgb(128, 128, 128) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--meta.mpe-syntax--diff.mpe-syntax--range { color: rgb(121, 93, 163) !important; font-weight: bold !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--meta.mpe-syntax--diff.mpe-syntax--header { color: rgb(0, 134, 179) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--meta.mpe-syntax--separator { font-weight: bold !important; color: rgb(29, 62, 129) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--meta.mpe-syntax--output { color: rgb(29, 62, 129) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--brackethighlighter.mpe-syntax--tag, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--brackethighlighter.mpe-syntax--curly, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--brackethighlighter.mpe-syntax--round, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--brackethighlighter.mpe-syntax--square, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--brackethighlighter.mpe-syntax--angle, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--brackethighlighter.mpe-syntax--quote { color: rgb(89, 94, 98) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--brackethighlighter.mpe-syntax--unmatched { color: rgb(181, 42, 29) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--sublimelinter.mpe-syntax--mark.mpe-syntax--error { color: rgb(181, 42, 29) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--sublimelinter.mpe-syntax--mark.mpe-syntax--warning { color: rgb(237, 106, 67) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--sublimelinter.mpe-syntax--gutter-mark { color: rgb(192, 192, 192) !important; }
.markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--constant.mpe-syntax--other.mpe-syntax--reference.mpe-syntax--link, .markdown-preview-enhanced[data-use-github-syntax-theme] .mpe-syntax--string.mpe-syntax--other.mpe-syntax--link { color: rgb(24, 54, 145) !important; text-decoration: underline !important; }
.markdown-preview-enhanced[data-presentation-mode] { font-size: 24px; width: 100%; box-sizing: border-box; margin: 0px; padding: 0px; }
.markdown-preview-enhanced[data-presentation-mode] h1, .markdown-preview-enhanced[data-presentation-mode] h2, .markdown-preview-enhanced[data-presentation-mode] h3, .markdown-preview-enhanced[data-presentation-mode] h4, .markdown-preview-enhanced[data-presentation-mode] h5, .markdown-preview-enhanced[data-presentation-mode] h6 { margin-top: 0px; }
.markdown-preview-enhanced[data-presentation-mode] strong { font-weight: bold; }
.markdown-preview-enhanced[data-presentation-mode]::-webkit-scrollbar { display: none; }
.markdown-preview-enhanced .slides { text-align: left !important; } </style> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">  </head> <body class="markdown-preview-enhanced " data-use-github-style data-use-github-syntax-theme > <style>
  p {
    text-align:justify;
  }
</style>
<h1 id="understanding-sebastian-madgwick-marg-filter-part-2">Understanding Sebastian Madgwick MARG filter - Part 2</h1>
<ul>
<li><p><a href="#8-testing-algorithm-real-data">8 Testing algorithm - real data</a>
<ul>
<li><p><a href="#81-test-1">8.1 Test 1</a></p></li>
<li><p><a href="#82-test-2">8.2 Test 2</a></p></li>
</ul></p></li>
<li><p><a href="#9-change-algorithm-to-use-only-magnetometer-x-and-y-axis">9 Change algorithm to use only magnetometer X and Y axis</a>
<ul>
<li><p><a href="#91-results-for-test-1">9.1 Results for test 1</a></p></li>
<li><p><a href="#92-results-for-test-2">9.2 Results for test 2</a></p></li>
</ul></p></li>
<li><p><a href="#10-results-for-real-road-test">10 Results for real road test</a></p></li>
</ul>
<hr>
<h2 id="8-testing-algorithm-real-data">8 Testing algorithm - real data</h2>
<p>For the tests, the real data was collected using a Sparkfun razor 9dof v.10125 and gnss signals from Novatel Flexpak G2. The image below show us the ENU position collected using the gnss sensor.<br>
The car was moving in a paved road but with some debris present in the first tests with no buildings in the sorrounding areas and with small trees in some parts of the circuit. The last test was made in urban enviroment. A few portionsof the circuit had close buildings in both sides and lots of cars parked also. At least one portion of the circuit had an high inclination.</p>
<h3 id="81-test-1">8.1 Test 1</h3>
<p>The following image show the XY ENU coordinates where the data is collected.<br>
<img src="svgs/real/gps_enu.svg" alt=""><br>
The test consisted in moving along the track two times in the clockwise direction starting from position (0,0).<br>
Next is present the euler angles estimated by the algorithm with no corrections and also the Mahony version.<br>
<img src="svgs/real/euler_both_noCorrections_din0.svg" alt=""><br>
But now, let us show the accelerometer and magnetometer readings and the respective norms also.</p>
<table>
<thead>
<tr><th style="text-align:center">Accelerometer</th><th style="text-align:center">Magnetometer</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/acc_din0.png" alt=""></td><td style="text-align:center"><img src="png/real/mag_din0.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>Norm Accelerometer</strong></td><td style="text-align:center"><strong>Norm Magnetometer</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/accMag_din0.png" alt=""></td><td style="text-align:center"><img src="png/real/magNorm_din0.png" alt=""></td></tr>
</tbody>
</table>
<p>It is clear the presence of accelerations, so as seen in the simulations, it is expected to behave badly. The Z-axis is considerated well behaved. The acceleration relatively constant in this axis around 1g. The Y axis (pointing front of the car) would represent the linnear acceleration of the vehicle. During the first two seconds, when the movement starts, it is possible to see the initial accelerations and possible gear shifts. Also at the end, is clearly seen the vehicle stoping. During the the rest of the movement, the small fluctuation around rest position value can be considerated normal due to the difficult of making the gas static.</p>
<p>The x-axis takes much more fluctuation wich seems consistent with vehicle turns and, as expected, should represent the centrifugal acceleration and possible suspention movement (the last term may also affect y-axis)</p>
<p>Looking for the norm of accelerations, it is seen that lot os samples relie in the expected interval of ~1g mean and 99% interval of confidence (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>μ</mi><mo>±</mo><mn>3</mn><mi>σ</mi></mrow><annotation encoding="application/x-tex">\mu \pm 3\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">μ</span><span class="mbin">±</span><span class="mord mathrm">3</span><span class="mord mathit" style="margin-right:0.03588em;">σ</span></span></span></span>) calculated within the no movement initial period (around 700 first samples).</p>
<p>However, looking at the magnetometer, norm of it is majority outside the initial no movement estimated mean and 99% IC. Does it mean the magnetic field varies so greatly between small location of the track? It was expected to not, there was no buildings, cars or other clear sources of magnetic fields or capable of interfering with earth magnetic field. Recalling the fact that magnetometer was unable to be calibrated in the z direction, it is believed that this is the major source of this unexcepcted out of range norm and z great variance.<br>
This will result only in a few samples will be actually used by improved version to correct the yaw angle and the system will relie in the majority of time on the gyroscopes integration for the yaw angle, wich is not advised.<br>
However since the calibration was possible in XY plane, another version of the algorithm can be derived, where instead of looking for the norm of magnetometer vector, only the norm of X and Y components are used.</p>
<table>
<thead>
<tr><th style="text-align:center">Magnetometer (Norm XY)</th><th style="text-align:center">Magnetometer (Norm of all)</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/magNormXY_din0.png" alt=""></td><td style="text-align:center"><img src="png/real/magNorm_din0.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>Euler angles</strong></td><td style="text-align:center"><strong>Euler angles</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/euler_withCorrectionsV2_din0.png" alt=""></td><td style="text-align:center"><img src="png/real/euler_withCorrectionsV1_din0.png" alt=""></td></tr>
</tbody>
</table>
<p>Using norm for XY axis only, many samples from magnetometer can now be used in the correction.</p>
<p>Comparing now the results for the yaw angle, using the norm of all components vs norm of XY axis only:</p>
<table>
<thead>
<tr><th style="text-align:center">Magnetometer (Norm XY)</th><th style="text-align:center">Magnetometer (Norm of all)</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/yaw_comparisonV2_din0.png" alt=""></td><td style="text-align:center"><img src="png/real/yaw_comparisonV1_din0.png" alt=""></td></tr>
</tbody>
</table>
<p>It seems the version using magnetometer norm of XY axis only, creates a delay when rapid change occurs (see peaks around 6 seconds) but near stationary orientation the filter, the xy version seems to track better than normal version (see around 5, 9, 11 ,15 seconds ). In red is marked the simple yaw estimation from the magnetometer XY-axis given by:<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ψ</mi><mo>=</mo><mi>a</mi><mi>t</mi><mi>a</mi><mi>n</mi><mn>2</mn><mo>(</mo><msub><mi>m</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>m</mi><mi>y</mi></msub><mo>)</mo><mo>+</mo><mi>D</mi></mrow><annotation encoding="application/x-tex">\psi = atan2(m_x, m_y) + D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">ψ</span><span class="mrel">=</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathrm">2</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span></span><br>
where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span> is the local magnetic declination and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>m</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">m_x,m_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span> the measurements of magnetometer in axis X and Y in the body frame, given the possible calibration.</p>
<h3 id="82-test-2">8.2 Test 2</h3>
<p>The new test is basically the same as previous but a serious of turns was made, trying to hold the steering wheel as fixed as humanly possible.</p>
<p><img src="svgs/real/gps_enu_din0_circ.svg" alt=""></p>
<table>
<thead>
<tr><th style="text-align:center">Accelerometer</th><th style="text-align:center">Magnetometer</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/acc_din0_circ.png" alt=""></td><td style="text-align:center"><img src="png/real/mag_din0_circ.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>Norm Accelerometer</strong></td><td style="text-align:center"><strong>Norm Magnetometer</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/accMag_din0_circ.png" alt=""></td><td style="text-align:center"><img src="png/real/magNorm_din0_circ.png" alt=""></td></tr>
</tbody>
</table>
<p>Again is clear the presence of external acceleration and during the circular turns is clear the presence of centrifugal acceleration.</p>
<table>
<thead>
<tr><th style="text-align:center">Magnetometer (Norm XY)</th><th style="text-align:center">Magnetometer (Norm of all)</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/magNormXY_din0_circ.png" alt=""></td><td style="text-align:center"><img src="png/real/magNorm_din0_circ.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>Euler angles</strong></td><td style="text-align:center"><strong>Euler angles</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/euler_withCorrectionsV2_din0_circ.png" alt=""></td><td style="text-align:center"><img src="png/real/euler_withCorrectionsV1_din0_circ.png" alt=""></td></tr>
</tbody>
</table>
<p>Here the must interesting point is the fact that, during the turns, the improved versions output of yaw angle is valrying approximate linear as expected when compared to the simple version of Madgwick algorithm.</p>
<p>But if we look at yaw angle only, when the movement is changing rapidly, as before in <a href="#81-test-1">8.1</a>, they seems not converge quickly enougth.</p>
<table>
<thead>
<tr><th style="text-align:center">Magnetometer (Norm XY)</th><th style="text-align:center">Magnetometer (Norm of all)</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/yaw_comparisonV2_din0_circ.png" alt=""></td><td style="text-align:center"><img src="png/real/yaw_comparisonV1_din0_circ.png" alt=""></td></tr>
</tbody>
</table>
<h2 id="9-change-algorithm-to-use-only-magnetometer-x-and-y-axis">9 Change algorithm to use only magnetometer X and Y axis</h2>
<p>By looking to plots of euler yaw angle estimated by only using the X and Y axis of magnetometer readings it seems most of the time, the estimate was following better the assumed correct reference given by the velocity of gnss.<br>
Since the objective is to used with a car, does the car is approximate near the horizontal plane?<br>
In order to achieve the answer looking at the road structure official guidelines<sup id="a1"><a href="#f1">1</a></sup>. The advized maximum percentage of inclination for roads is expressed<br>
in the following table:</p>
<table>
<thead>
<tr><th style="text-align:center">Base velocity (km/h)</th><th style="text-align:center">Max. Inclination advice (%)</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center">40</td><td style="text-align:center">8</td></tr>
<tr><td style="text-align:center">60</td><td style="text-align:center">7</td></tr>
<tr><td style="text-align:center">80</td><td style="text-align:center">6</td></tr>
<tr><td style="text-align:center">100</td><td style="text-align:center">5</td></tr>
<tr><td style="text-align:center">120</td><td style="text-align:center">4</td></tr>
<tr><td style="text-align:center">140</td><td style="text-align:center">3</td></tr>
</tbody>
</table>
<p><strong>NOTES:</strong> for autoroutes the maximum inclination should be 3%. This inclinations can be surpassed as long as it is for a limited distance. Municipal roads can also surpasse this values but is also advised to be used.</p>
<p>Let us calculate the result in degrees for the percentages using<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>n</mi><mi>g</mi><mi>l</mi><mi>e</mi><mo>=</mo><mi>arctan</mi><mo>(</mo><mfrac><mrow><mi>p</mi><mi>e</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow><mrow><mn>1</mn><mn>0</mn><mn>0</mn></mrow></mfrac><mo>)</mo></mrow><annotation encoding="application/x-tex">angle = \arctan(\frac{percentage}{100})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.29208em;"></span><span class="strut bottom" style="height:1.9780799999999998em;vertical-align:-0.686em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span><span class="mrel">=</span><span class="mop">arctan</span><span class="mopen">(</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="mopen sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathit">p</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p>
<table>
<thead>
<tr><th style="text-align:center">Max. Inclination advice (%)</th><th style="text-align:center">Angle (degrees)</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center">15</td><td style="text-align:center">8.53</td></tr>
<tr><td style="text-align:center">10</td><td style="text-align:center">5.71</td></tr>
<tr><td style="text-align:center">8</td><td style="text-align:center">4.57</td></tr>
<tr><td style="text-align:center">7</td><td style="text-align:center">4.00</td></tr>
<tr><td style="text-align:center">6</td><td style="text-align:center">3.43</td></tr>
<tr><td style="text-align:center">5</td><td style="text-align:center">2.86</td></tr>
<tr><td style="text-align:center">4</td><td style="text-align:center">2.29</td></tr>
<tr><td style="text-align:center">3</td><td style="text-align:center">1.72</td></tr>
</tbody>
</table>
<p>Using this, we can assume the car inclination angles are small enougth, or by other words, the car is near the horizontal plane, in order to the magnitude of z-axis of the magnetic field create a significant influence.<br>
For instance, the change in horizontal magnitude due to angle of 5.71 degrees, in Lisbon (2017) would be<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mi>e</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>r</mi></mrow></mtd><mtd><mrow><mo>=</mo><mn>2</mn><mn>6</mn><mn>5</mn><mn>0</mn><mn>0</mn><mi mathvariant="normal">.</mi><mn>6</mn><mo>(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mo>(</mo><mn>5</mn><mi mathvariant="normal">.</mi><mn>7</mn><msup><mn>1</mn><mi>o</mi></msup><mo>)</mo><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mo>=</mo><mn>1</mn><mn>3</mn><mn>1</mn><mi mathvariant="normal">.</mi><mn>4</mn><mn>9</mn><mn>0</mn><mn>1</mn><mo>[</mo><mi>n</mi><mi>T</mi><mo>]</mo></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{array}{ll}
error &amp;= 26500.6(1-\cos(5.71^o)) \\
&amp;= 131.4901[nT]
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.45em;"></span><span class="strut bottom" style="height:2.4000000000000004em;vertical-align:-0.9500000000000004em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mord mathrm">6</span><span class="mord mathrm">5</span><span class="mord mathrm">0</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">6</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathrm">5</span><span class="mord mathrm">.</span><span class="mord mathrm">7</span><span class="mord"><span class="mord mathrm">1</span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight">o</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mord mathrm">3</span><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">4</span><span class="mord mathrm">9</span><span class="mord mathrm">0</span><span class="mord mathrm">1</span><span class="mopen">[</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mclose">]</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span><br>
That said, let us change the section of magnetometer for the matrices  <em>f</em> and <em>J</em> for taking only account of the horizontal component of earth magnetic field (see section 5.1 and 4.3 of <a href="./testing_madgwick.html">part 1</a>).<br>
The new vector <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><msup><mrow></mrow><mi>w</mi></msup></mrow><mover accent="true"><mrow><mi>h</mi></mrow><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">{^w}\hat{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.9578799999999998em;"></span><span class="strut bottom" style="height:0.9578799999999998em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit">h</span></span></span><span style="top:-0.26343999999999995em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> will then become:<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mrow><msup><mrow></mrow><mi>w</mi></msup></mrow><mover accent="true"><mrow><mi>d</mi></mrow><mo>^</mo></mover></mrow></mtd><mtd><mrow><mo>=</mo><mrow><msup><mrow></mrow><mi>w</mi></msup></mrow><mover accent="true"><mrow><mi>h</mi></mrow><mo>^</mo></mover></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mo>=</mo><mo>[</mo><mn>0</mn><mspace width="1em"></mspace><mn>0</mn><mspace width="1em"></mspace><msub><mi>h</mi><mi>y</mi></msub><mspace width="1em"></mspace><mn>0</mn><mo>]</mo></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mo>=</mo><mo>[</mo><mn>0</mn><mspace width="1em"></mspace><mn>0</mn><mspace width="1em"></mspace><mi>cos</mi><mo>(</mo><mi>I</mi><mo>)</mo><mspace width="1em"></mspace><mn>0</mn><mo>]</mo></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mo>=</mo><mo>[</mo><mn>0</mn><mspace width="1em"></mspace><mn>0</mn><mspace width="1em"></mspace><mn>0</mn><mi mathvariant="normal">.</mi><mn>6</mn><mn>0</mn><mn>4</mn><mn>9</mn><mspace width="1em"></mspace><mn>0</mn><mo>]</mo></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{array}{ll}
{^w}\hat{d} &amp;= {^w}\hat{h} \\
      \\
      &amp;= [0\quad 0\quad h_y\quad 0] \\
      \\
      &amp;= [0\quad 0\quad \cos(I)\quad 0] \\
      \\
      &amp;= [0\quad 0\quad 0.6049\quad 0]
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:4.50894em;"></span><span class="strut bottom" style="height:8.517880000000002em;vertical-align:-4.008940000000001em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-3.55106em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">d</span></span></span><span style="top:-0.26343999999999995em;margin-left:0.33334em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:-2.3510599999999995em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:-1.15106em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:0.04894000000000026em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:1.2489400000000004em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:2.448940000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:3.648940000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-3.55106em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">h</span></span></span><span style="top:-0.26343999999999995em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:-1.15106em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mord"><span class="mspace quad"></span><span class="mord mathit">h</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mclose">]</span></span></span><span style="top:1.2489400000000004em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mop"><span class="mspace quad"></span>cos</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mclose">)</span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mclose">]</span></span></span><span style="top:3.648940000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mord mathrm">.</span><span class="mord mathrm">6</span><span class="mord mathrm">0</span><span class="mord mathrm">4</span><span class="mord mathrm">9</span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mclose">]</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p>
<p>and normalizing again will result in:<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><msup><mrow></mrow><mi>w</mi></msup></mrow><mover accent="true"><mrow><mi>h</mi></mrow><mo>^</mo></mover><mo>=</mo><mo>[</mo><mn>0</mn><mspace width="1em"></mspace><mn>0</mn><mspace width="1em"></mspace><mn>1</mn><mspace width="1em"></mspace><mn>0</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">{^w}\hat{h}=[0\quad 0\quad 1\quad 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.9578799999999998em;"></span><span class="strut bottom" style="height:1.2078799999999998em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord textstyle cramped"><span class="mord mathit">h</span></span></span><span style="top:-0.26343999999999995em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">1</span></span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mclose">]</span></span></span></span></p>
<p>For every reading in magnetometer it will be used:<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><msup><mrow></mrow><mi>b</mi></msup></mrow><mover accent="true"><mrow><mi>m</mi></mrow><mo>^</mo></mover><mo>=</mo><mo>[</mo><mn>0</mn><mspace width="1em"></mspace><msub><mi>m</mi><mi>x</mi></msub><mspace width="1em"></mspace><msub><mi>m</mi><mi>y</mi></msub><mspace width="1em"></mspace><mn>0</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">{^b}\hat{m} = [0\quad m_x\quad m_y\quad 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8991079999999999em;"></span><span class="strut bottom" style="height:1.1852159999999998em;vertical-align:-0.286108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight">b</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">m</span></span></span><span style="top:0em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord"><span class="mspace quad"></span><span class="mord mathit">m</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mspace quad"></span><span class="mord mathit">m</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord mathrm"><span class="mspace quad"></span><span class="mord mathrm">0</span></span><span class="mclose">]</span></span></span></span></span><br>
so that also the resulting normalization will only reflect the components XY - axis.<br>
The new <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">f_h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">h</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>J</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">J_h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.09618em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">h</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span> matrices will be:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mi>f</mi><mo>(</mo><mrow><msubsup><mrow></mrow><mi>w</mi><mi>b</mi></msubsup></mrow><msub><mover accent="true"><mrow><mi>q</mi></mrow><mo>^</mo></mover><mi>k</mi></msub><mo separator="true">,</mo><mrow><msup><mrow></mrow><mi>w</mi></msup></mrow><mover accent="true"><mrow><mi>h</mi></mrow><mo>^</mo></mover><mo separator="true">,</mo><mrow><msup><mrow></mrow><mi>b</mi></msup></mrow><mover accent="true"><mrow><mi>m</mi></mrow><mo>^</mo></mover><mo>)</mo></mrow></mtd><mtd><mrow><mo>=</mo><msub><mi>f</mi><mi>h</mi></msub><mo>(</mo><mrow><msubsup><mrow></mrow><mi>w</mi><mi>b</mi></msubsup></mrow><msub><mover accent="true"><mrow><mi>q</mi></mrow><mo>^</mo></mover><mi>k</mi></msub><mo separator="true">,</mo><mrow><msup><mrow></mrow><mi>w</mi></msup></mrow><mover accent="true"><mrow><mi>h</mi></mrow><mo>^</mo></mover><mo separator="true">,</mo><mrow><msup><mrow></mrow><mi>b</mi></msup></mrow><mover accent="true"><mrow><mi>m</mi></mrow><mo>^</mo></mover><mo>)</mo><mo>=</mo></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mn>2</mn><mo>(</mo><msub><mi>q</mi><mn>1</mn></msub><msub><mi>q</mi><mn>4</mn></msub><mo>+</mo><msub><mi>q</mi><mn>2</mn></msub><msub><mi>q</mi><mn>3</mn></msub><mo>)</mo><mo>−</mo><msub><mi>m</mi><mi>x</mi></msub></mrow></mtd></mtr><mtr><mtd><mrow><mn>2</mn><mo>(</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mn>2</mn></mrow></mfrac><mo>−</mo><msubsup><mi>q</mi><mn>2</mn><mn>2</mn></msubsup><mo>−</mo><msubsup><mi>q</mi><mn>4</mn><mn>2</mn></msubsup><mo>)</mo><mo>−</mo><msub><mi>m</mi><mi>y</mi></msub></mrow></mtd></mtr><mtr><mtd><mrow><mn>2</mn><mo>(</mo><msub><mi>q</mi><mn>3</mn></msub><msub><mi>q</mi><mn>4</mn></msub><mo>−</mo><msub><mi>q</mi><mn>1</mn></msub><msub><mi>q</mi><mn>2</mn></msub><mo>)</mo><mo>−</mo><mn>0</mn></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{array}{ll}
f( {^b_w}\hat{q}_k,{^w}\hat{h}, {^b}\hat{m}) &amp;= f_h( {^b_w}\hat{q}_k, {^w}\hat{h}, {^b}\hat{m})=\\
\\
      &amp;=\begin{bmatrix}
          2(q_1q_4+q_2q_3)            - m_x \\
          2(\frac{1}{2} -q^2_2-q^2_4) - m_y \\
          2(q_3q_4 -q_1q_2)           - 0
        \end{bmatrix}
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:3.7126600000000005em;"></span><span class="strut bottom" style="height:6.925320000000001em;vertical-align:-3.212660000000001em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-2.7547800000000007em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:0.247em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight">b</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">q</span></span></span><span style="top:0em;margin-left:0.16668em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mpunct">,</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">h</span></span></span><span style="top:-0.26343999999999995em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight">b</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">m</span></span></span><span style="top:0em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span><span style="top:-1.5547800000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:1.2589400000000008em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-2.7547800000000007em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">h</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:0.247em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight">b</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">q</span></span></span><span style="top:0em;margin-left:0.16668em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mpunct">,</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">h</span></span></span><span style="top:-0.26343999999999995em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight">b</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">m</span></span></span><span style="top:0em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span></span></span><span style="top:1.2589399999999995em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="mopen style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:1.2050049999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:0.05000500000000008em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-1.196015em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-1.61372em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">4</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">3</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mclose">)</span><span class="mbin">−</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:0.06771999999999989em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mopen">(</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="mopen sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">2</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.247em;margin-left:-0.03588em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">2</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.247em;margin-left:-0.03588em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">4</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mclose">)</span><span class="mbin">−</span><span class="mord"><span class="mord mathit">m</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:1.59372em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">3</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">4</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mbin">−</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mclose">)</span><span class="mbin">−</span><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mclose style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:1.2050049999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:0.05000500000000008em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-1.196015em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span><br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mi>J</mi><mo>(</mo><mrow><msubsup><mrow></mrow><mi>w</mi><mi>b</mi></msubsup></mrow><msub><mover accent="true"><mrow><mi>q</mi></mrow><mo>^</mo></mover><mi>k</mi></msub><mo separator="true">,</mo><mrow><msup><mrow></mrow><mi>w</mi></msup></mrow><mover accent="true"><mrow><mi>d</mi></mrow><mo>^</mo></mover><mo>)</mo></mrow></mtd><mtd><mrow><mo>=</mo><msub><mi>J</mi><mi>h</mi></msub><mo>(</mo><mrow><msubsup><mrow></mrow><mi>w</mi><mi>b</mi></msubsup></mrow><msub><mover accent="true"><mrow><mi>q</mi></mrow><mo>^</mo></mover><mi>k</mi></msub><mo separator="true">,</mo><mrow><msup><mrow></mrow><mi>w</mi></msup></mrow><mover accent="true"><mrow><mi>h</mi></mrow><mo>^</mo></mover><mo>)</mo><mo>=</mo></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mn>2</mn><msub><mi>q</mi><mn>4</mn></msub></mrow></mtd><mtd><mrow><mn>2</mn><msub><mi>q</mi><mn>3</mn></msub></mrow></mtd><mtd><mrow><mn>2</mn><msub><mi>q</mi><mn>2</mn></msub></mrow></mtd><mtd><mrow><mn>2</mn><msub><mi>q</mi><mn>1</mn></msub></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>4</mn><msub><mi>q</mi><mn>2</mn></msub></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>4</mn><msub><mi>q</mi><mn>4</mn></msub></mrow></mtd></mtr><mtr><mtd><mrow><mo>−</mo><mn>2</mn><msub><mi>q</mi><mn>2</mn></msub></mrow></mtd><mtd><mrow><mo>−</mo><mn>2</mn><msub><mi>q</mi><mn>1</mn></msub></mrow></mtd><mtd><mrow><mn>2</mn><msub><mi>q</mi><mn>4</mn></msub></mrow></mtd><mtd><mrow><mn>2</mn><msub><mi>q</mi><mn>3</mn></msub></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{array}{ll}
J( {^b_w}\hat{q}_k,{^w}\hat{d}) &amp;= J_h( {^b_w}\hat{q}_k,{^w}\hat{h})=\\
\\
  &amp;=\begin{bmatrix}
      2q_4  &amp; 2 q_3  &amp; 2q_2  &amp; 2q_1 \\
      0     &amp;-4q_2   &amp; 0     &amp;-4q_4 \\
     -2q_2  &amp;-2q_1   &amp; 2q_4  &amp; 2q_3
    \end{bmatrix}
\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:3.30896em;"></span><span class="strut bottom" style="height:6.11792em;vertical-align:-2.80896em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-2.35108em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:0.247em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight">b</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">q</span></span></span><span style="top:0em;margin-left:0.16668em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mpunct">,</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">d</span></span></span><span style="top:-0.26343999999999995em;margin-left:0.33334em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span><span style="top:-1.15108em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:1.25894em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-2.35108em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.09618em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">h</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:0.247em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight">b</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">q</span></span></span><span style="top:0em;margin-left:0.16668em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mpunct">,</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span></span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle cramped"><span class="mord mathit">h</span></span></span><span style="top:-0.26343999999999995em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="accent-body"><span>^</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span></span></span><span style="top:1.25894em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="mopen style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">4</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord">−</span><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">3</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord">−</span><span class="mord mathrm">4</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord">−</span><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">4</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2099999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.00999999999999951em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord">−</span><span class="mord mathrm">4</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">4</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:1.1900000000000006em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">3</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="mclose style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p>
<h3 id="91-results-for-test-1">9.1 Results for test 1</h3>
<table>
<thead>
<tr><th style="text-align:center">Euler angles (version XY axis only vs Improved)</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/euler_xy_version_vs_improved_din0.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>Yaw Angle</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/yaw_comparison_xy_version_din0.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>External Accelerations estimation</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/acc_estimation_xy_version.png" alt=""></td></tr>
</tbody>
</table>
<h3 id="92-results-for-test-2">9.2 Results for test 2</h3>
<table>
<thead>
<tr><th style="text-align:center">Euler angles (version XY axis only vs Improved)</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/euler_xy_version_vs_improved_din0_circ.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>Yaw Angle</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/yaw_comparison_xy_version_din0_circ.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>External Accelerations estimation</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/acc_estimation_xy_version_din0_circ.png" alt=""></td></tr>
</tbody>
</table>
<h2 id="10-results-for-real-road-test">10 Results for real road test</h2>
<p>This test was made in a normal road with sections where buildings and lots of cars are parked in the road sides. Also one section includes a slope with significant inclination.</p>
<table>
<thead>
<tr><th style="text-align:center">Map locations for road test</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/google_map_din0_estrada.png" alt=""></td></tr>
<tr><td style="text-align:center"><img src="svgs/real/gps_enu_din0_estrada.svg" alt=""></td></tr>
</tbody>
</table>
<table>
<thead>
<tr><th style="text-align:center">Euler angles (version XY axis only vs Improved)</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center"><img src="png/real/euler_xy_version_vs_improved_din0_estrada.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>Yaw Angle</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/yaw_comparison_xy_version_din0_estrada.png" alt=""></td></tr>
<tr><td style="text-align:center"><strong>External Accelerations estimation</strong></td></tr>
<tr><td style="text-align:center"><img src="png/real/acc_estimation_xy_version_din0_estrada.png" alt=""></td></tr>
</tbody>
</table>
<div align="center">
<iframe width="853" height="480" src="https://www.youtube.com/embed/d4yVI4hnM34?rel=0" frameborder="0" allowfullscreen=""></iframe>
</div>
<p><b id="f1">[1]</b> <a href="http://www.imt-ip.pt/sites/IMTT/Portugues/InfraestruturasRodoviarias/InovacaoNormalizacao/Divulgao%20Tcnica/RevisaoNormaDeTracado.pdf">Norma De Tracado, p.34</a>. <a href="#a1">↩</a></p>
<p><a href="https://en.wikibooks.org/wiki/Fundamentals_of_Transportation/Grade#Grade_Computation">Wikipedia source</a></p>
 </body>  </html>