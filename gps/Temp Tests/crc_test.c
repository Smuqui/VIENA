#include <stdio.h>

#define CRC32_POLYNOMIAL 0xEDB88320L

/* --------------------------------------------------------------------------
Calculate a CRC value to be used by CRC calculation functions.
-------------------------------------------------------------------------- */
unsigned int CRC32Value(int i)
{
    int j;
    unsigned int ulCRC;
    ulCRC = i;
    for ( j = 8 ; j > 0; j-- )
    {
        if ( ulCRC & 1 )
            ulCRC = ( ulCRC >> 1 ) ^ CRC32_POLYNOMIAL;
        else
            ulCRC >>= 1;
    }
    return ulCRC;
}
/* --------------------------------------------------------------------------
Calculates the CRC-32 of a block of data all at once
-------------------------------------------------------------------------- */
unsigned int CalculateBlockCRC32(
    unsigned int ulCount, /* Number of bytes in the data block */
    unsigned char *ucBuffer ) /* Data block */
{
    unsigned int ulTemp1;
    unsigned int ulTemp2;
    unsigned int ulCRC = 0;
    while ( ulCount-- != 0 )
    {
        ulTemp1 = ( ulCRC >> 8 ) & 0x00FFFFFFL;
        ulTemp2 = CRC32Value( ((int) ulCRC ^ *ucBuffer++ ) & 0xff );
        ulCRC = ulTemp1 ^ ulTemp2;
    }
    return( ulCRC );
}

int main(){
    /*
    unsigned char buffer[] = {0xAA, 0x44, 0x12, 0x1C, 0x2A, 0x00, 0x02, 0x42, 0x48, 0x00, 0x00, 0x00, 0x96, 0xB4, 0x05, 0x05,
        0x90, 0x32, 0x8E, 0x09, 0x20, 0x00, 0x00, 0x00, 0x41, 0x59, 0x8C, 0x04, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
        0x03, 0x9A, 0x8A, 0x8A, 0xE6, 0x8E, 0x49, 0x40, 0xEB, 0xD8, 0xE7, 0xB2, 0x73, 0x82, 0x5C, 0xC0, 0x00, 0xB0, 0xDD,
        0xA2, 0x37, 0x9B, 0x90, 0x40, 0x80, 0x2B, 0x82, 0xC1, 0x3D, 0x00, 0x00, 0x00, 0x9D, 0xDA, 0x3F, 0xF7, 0x58, 0xA1,
        0x3F, 0x3F, 0xF4, 0x32, 0x89, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0x0A,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    */
    unsigned char buffer[] = {0xAA, 0x44, 0x12, 0x1C, 0x01, 0x00, 0x02, 0x40, 0x20, 0x00, 0x00, 0x00,
     0x1D, 0x1D, 0x00, 0x00, 0x29, 0x16, 0x00, 0x00, 0x00, 0x00, 0x4C, 0x00,
     0x55, 0x52, 0x5A, 0x80, 0x20, 0x00, 0x00, 0x00, 0x2A, 0x00, 0x00, 0x00,
     0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x3F,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

        unsigned int crc = CalculateBlockCRC32(sizeof(buffer), buffer);
        printf("Tamanho %d bytes\n", (int) sizeof(buffer));
        printf("%x\n",crc);
        return 0;
        /*Please note that this hex needs to be reversed due to Big Endian order where the most significant value in the sequence is
        stored first (at the lowest storage address). For example, the two bytes required for the hex number 4F52 is stored as 524F.
        */
    }